"""Blackjack, by Al Sweigart al@inventwithpython.com
The classic card game also known as 21. (This version doesn't have
splitting or insurance.)
More info at: https://en.wikipedia.org/wiki/Blackjack
This and other games are available at https://nostarch.com/XX
Tags: large, game, card game"""
__version__ = 0
import random

# Set up the constants:
HEARTS = chr(9829)  # Character 9829 is '♥'.
DIAMONDS = chr(9830)  # Character 9830 is '♦'.
SPADES = chr(9824)  # Character 9824 is '♠'.
CLUBS = chr(9827)  # Character 9827 is '♣'.
# (A list of chr codes is at https://inventwithpython.com/charactermap)
BACKSIDE = "backside"


def getDeck():
    """Return a list of (rank, suit) tuples for all 52 cards."""
    deck = []
    for suit in (HEARTS, DIAMONDS, SPADES, CLUBS):
        for rank in range(2, 11):
            deck.append((str(rank), suit))  # Add the numbered cards.
        for rank in ("J", "Q", "K", "A"):
            deck.append((rank, suit))  # Add the face and ace cards.
    random.shuffle(deck)
    return deck


def displayHands(playerHand, dealerHand, showDealerHand):
    """Show the player's and dealer's cards. Hide the dealer's first
    card if showDealerHand is False."""
    result = {}
    if showDealerHand:
        result["dealer"] = displayCards(dealerHand)
        result["dealer_header"] = getCardValue(dealerHand)
    else:
        result["dealer_header"] = "???"
        # Hide the dealer's first card:
        result["dealer"] = displayCards([BACKSIDE] + dealerHand[1:])

    # Show the player's cards:
    result["player"] = displayCards(playerHand)
    result["player_header"] = getCardValue(playerHand)
    return result


def getCardValue(cards):
    """Returns the value of the cards. Face cards are worth 10, aces are
    worth 11 or 1 (this function picks the most suitable ace value)."""
    value = 0
    numberOfAces = 0

    # Add the value for the non-ace cards:
    for card in cards:
        rank = card[0]  # card is a tuple like (rank, suit)
        if rank == "A":
            numberOfAces += 1
        elif rank in ("K", "Q", "J"):  # Face cards are worth 10 points.
            value += 10
        else:
            value += int(rank)  # Numbered cards are worth their number.

    # Add the value for the aces:
    value += numberOfAces  # Add 1 per ace.
    for i in range(numberOfAces):
        # If another 10 can be added with busting, do so:
        if value + 10 <= 21:
            value += 10

    return value


def displayCards(cards):
    """Display all the cards in the cards list."""
    rows = ["", "", "", "", ""]  # The text to display on each row.

    for i, card in enumerate(cards):
        rows[0] += " ___  "  # Print the top line of the card.
        if card == BACKSIDE:
            # Print a card's back:
            rows[1] += "|## | "
            rows[2] += "|###| "
            rows[3] += "|_##| "
        else:
            # Print the card's front:
            rank, suit = card  # The card is a tuple data structure.
            rows[1] += "|{} | ".format(rank.ljust(2))
            rows[2] += "| {} | ".format(suit)
            rows[3] += "|_{}| ".format(rank.rjust(2, "_"))

    # Print each row on the screen:
    data = ""
    for row in rows:
        data += row + "\n"
    return data
